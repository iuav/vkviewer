<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; CHARSET=UTF-8">
        <link rel="stylesheet" href="./../lib/jquery-ui-1.10.3/themes/base/jquery-ui.css" />
        <link rel="stylesheet" href="../css/vk2/tools/LayerManagement.css" /> 
	<style>
		#map{
			position: absolute;
		    height: 100%;
		    width: 100%;
		}
		
		#vk2LayerbarPanel{
		    position: absolute;
		    top: 100px !important;
		    right: 0px;
		}

	</style>
        <script src="../lib/jquery-ui-1.10.3/jquery-1.9.1.js"></script>
        <script src="../lib/jquery-ui-1.10.3/ui/jquery-ui.js"></script>  
        <script src="../lib/OpenLayers-2.13.1/OpenLayers.js" type="text/javascript"></script>  
        <script src="../lib/jquery.tabSlideOut.js" type="text/javascript"></script>
      <script src="../js/Vkviewer.js"></script>
      <script src="../js/locale/de.js"></script>
        <script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
        <script type="text/javascript">
        	OpenLayers.ProxyHost = "http://localhost:8080/vkviewer/proxy/?url=";;
        	var map = null;
        	var layerManagement = null;
            
        	var getMap = function(div){
        		var map = new OpenLayers.Map(div,{
        			projection: new OpenLayers.Projection("EPSG:900913"),
        	        displayProjection: new OpenLayers.Projection("EPSG:900913"),
        	        units: "m",
        	        maxExtent: new OpenLayers.Bounds(1175366.9698897,6434961.1964864,1958082.1394209,6834879.7284188),
        	        resolutions : [38.21851413574219, 19.109257067871095, 9.5546285339355475, 4.7773142669677737, 2.3886571334838869, 1.1943285667419434],
        	        maxResolution: 38.21851413574219,
        	        controls: [
        	                  new OpenLayers.Control.Navigation(),
        	                  new OpenLayers.Control.PanZoom(),
        	                  new OpenLayers.Control.Attribution()
        	        ] 
        		})
        		
        		// add layer osm mapnik
        		//var layerMapnik = new OpenLayers.Layer.OSM("Mapnik");
        		//map.addLayer(layerMapnik);
        		
        		// add layer google street
        	    var gmap = new OpenLayers.Layer.Google(
        	            "Google Streets", // the default
        	            {numZoomLevels: 20}
        	            // default type, no change needed here
        	    );
        		map.addLayer(gmap);
        		
//        		var mapnik = new OpenLayers.Layer.OSM("OSM Mapnik");
//        		map.addLayer(mapnik);
        		
        		map.zoomToExtent(new OpenLayers.Bounds(1175366.9698897,6434961.1964864,1958082.1394209,6834879.7284188));
        		return map;
        	}
        	
        	var getTimeLayer = function(timestamp){
     			var vk2Layer = new OpenLayers.Layer.WMS('Historische Messtischblaetter',
   			        'http://194.95.145.43/cgi-bin/mtbows',
   			        {
   			                layers: 'Historische Messtischblaetter',
   			                type:	"png",
   			                format: "image/png",
   			                transparent: 'true',
   			                time: timestamp
   			        },{
   			                isBaseLayer: false,
   			                visibility: false,
   			                projection: new OpenLayers.Projection('EPSG:900913')
   			        }
   			    );
    			vk2Layer.wfsLayer = new OpenLayers.Layer.Vector('Historische_Messtischblaetter_WFS',{
   			        'displayInLayerSwitcher':false,
   			        styleMap: new OpenLayers.StyleMap({
   			            fillColor: "#ee9900",
   			            fillOpacity: "0.5"
   			        }),
   			        strategies: [
   			            new OpenLayers.Strategy.BBOX(),
   			            new OpenLayers.Strategy.Refresh({force: true, active: true})
   			        ],
   			        protocol: new OpenLayers.Protocol.WFS({
   			            "url": 'http://194.95.145.43/cgi-bin/mtbows',
   			            "geometryName": 'boundingbox',
   			            "featureNS" : 'http://mapserver.gis.umn.edu/mapserver',
   			            "featurePrefix": 'ms',
   			            "featureType": 'Historische_Messtischblaetter_WFS',
   			            "srsName": 'EPSG:900913',
   			            "maxFeatures": 10000,
   			            "version": '1.0.0'
   			         })
   			    }); 
    			
   				vk2Layer.id = OpenLayers.Util.createUniqueID('Historische Messtischblaetter'.split(" ").join("_") + "_");
   				vk2Layer.isTime = true;
   				vk2Layer.thumbnail = "/vkviewer/static/images/layer_default.png";
   				vk2Layer.extent = map.getExtent();
    			return vk2Layer;
        	}
        	
            $(document).ready(function(){
            	
            	// initialize map and zoom to extent from saxony
				map = getMap('map');
				map.zoomToExtent(new OpenLayers.Bounds(1526747.988868,6582561.0980844,1623440.8296352,6631862.9813214));

				// initialize layer management
				var eventFtLayer = VK2.Layer.EventFeatureLayer();
				var options = {
						map: map,
						div: document.getElementById('vk2LayerbarPanel'),
						id: 'layerbar_1',
						vk2featurelayer: eventFtLayer
				}
				layerManagement = new VK2.Tools.LayerManagement(options);
				
				$('.vk2LayerbarPanel').tabSlideOut({
				    tabHandle: '.vk2LayerbarHandle',  
				    pathToTabImage: './../images/search.png',
				    pathToTabImageClose: './../images/close.png',
				    imageHeight: '40px',                               
				    imageWidth: '40px',     
				    tabLocation: 'right', 
				    speed: 300,           
				    action: 'click',     
				    topPos: '50px',      
				    fixedPosition: false,
				    onLoadSlideOut: false,
				    activateCallback: function(key){
				    	console.log(key);
				    },
				    deactivateCallback: function(key){
				    	console.log(key);
				    },
				    toolKey: 'test'
				});	
				
				for (var i = 1911; i < 1912; i++){
					var layer = getTimeLayer(i);
					layerManagement.addLayer(layer);
				}
            });
            
        </script>
    </head>
    <body>
	<div id="map"></div>
	<div id="vk2LayerbarPanel" class="vk2LayerbarPanel">
		<a id="vk2LayerbarHandle" class="vk2LayerbarHandle" title="Layerauswahl"></a>
	</div>

	
    </body>
</html>
